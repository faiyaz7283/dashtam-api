# Dashtam Environment Flow Diagrams

## Development Environment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        DEVELOPMENT WORKFLOW                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Developer runs: make up
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚   Docker Compose reads:              â”‚
  â”‚   â€¢ docker-compose.yml               â”‚
  â”‚   â€¢ .env file                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚              CONTAINERS START (4 services)                  â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                             â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
  â”‚  â”‚ dashtam-postgresâ”‚  â”‚  dashtam-redis  â”‚                   â”‚
  â”‚  â”‚                 â”‚  â”‚                 â”‚                   â”‚
  â”‚  â”‚ DB: dashtam     â”‚  â”‚ Cache index: 0  â”‚                   â”‚
  â”‚  â”‚ User: dashtam_  â”‚  â”‚                 â”‚                   â”‚
  â”‚  â”‚       user      â”‚  â”‚                 â”‚                   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
  â”‚         â–²                     â–²                             â”‚
  â”‚         â”‚                     â”‚                             â”‚
  â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                             â”‚
  â”‚                   â”‚                                         â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
  â”‚  â”‚      dashtam-app                â”‚  â”‚ dashtam-callbackâ”‚   â”‚
  â”‚  â”‚      (port 8000)                â”‚  â”‚  (port 8182)    â”‚   â”‚
  â”‚  â”‚                                 â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚  1. Container starts            â”‚  â”‚ OAuth callback  â”‚   â”‚
  â”‚  â”‚  2. Runs: uv run python         â”‚  â”‚ server          â”‚   â”‚
  â”‚  â”‚     src/core/init_db.py         â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚  3. init_db.py:                 â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚     â”œâ”€ Load .env settings       â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚     â”œâ”€ Connect to dashtam DB    â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚     â”œâ”€ Import all models        â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚     â”œâ”€ Create tables if missing â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚     â””â”€ Log success âœ“            â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚  4. Starts FastAPI app          â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚  5. Hot reload enabled          â”‚  â”‚                 â”‚   â”‚
  â”‚  â”‚                                 â”‚  â”‚                 â”‚   â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
  â”‚                                                             â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  App Running & Ready                 â”‚
  â”‚  â€¢ https://localhost:8000            â”‚
  â”‚  â€¢ Auto-reload on code changes       â”‚
  â”‚  â€¢ Dev database has persistent data  â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Test Environment Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        TESTING WORKFLOW                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Developer runs: make test-setup
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Docker Compose reads:               â”‚
  â”‚  â€¢ docker-compose.yml                â”‚
  â”‚  â€¢ docker-compose.test.yml (overlay) â”‚
  â”‚  â€¢ .env.test (--env-file flag)       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Dev containers STOP                 â”‚
  â”‚  (if running)                        â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚     TEST CONTAINERS START (with overrides)     â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
  â”‚  â”‚        dashtam-postgres                  â”‚  â”‚
  â”‚  â”‚                                          â”‚  â”‚
  â”‚  â”‚  Environment Override:                   â”‚  â”‚
  â”‚  â”‚  â€¢ POSTGRES_DB=dashtam_test              â”‚  â”‚
  â”‚  â”‚  â€¢ POSTGRES_USER=dashtam_test_user       â”‚  â”‚
  â”‚  â”‚                                          â”‚  â”‚
  â”‚  â”‚  BOTH databases exist now:               â”‚  â”‚
  â”‚  â”‚  â”œâ”€ dashtam (dev data untouched)         â”‚  â”‚
  â”‚  â”‚  â””â”€ dashtam_test (for testing)           â”‚  â”‚
  â”‚  â”‚                                          â”‚  â”‚
  â”‚  â”‚  Init script runs:                       â”‚  â”‚
  â”‚  â”‚  docker/init-test-db.sh                  â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Creates dashtam_test_user            â”‚  â”‚
  â”‚  â”‚  â”œâ”€ Grants permissions                   â”‚  â”‚
  â”‚  â”‚  â””â”€ Enables UUID extension               â”‚  â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
  â”‚         â–²                    â–²                 â”‚
  â”‚         â”‚                    â”‚                 â”‚
  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
  â”‚  â”‚ dashtam-app     â”‚  â”‚ dashtam-redis   â”‚      â”‚
  â”‚  â”‚                 â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚ Overrides:      â”‚  â”‚ Cache index: 1  â”‚      â”‚
  â”‚  â”‚ â€¢ Command:      â”‚  â”‚ (different)     â”‚      â”‚
  â”‚  â”‚   sleep infinityâ”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚ â€¢ Mounts:       â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   .env.test     â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   as .env       â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚ â€¢ Env vars:     â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   DATABASE_URL= â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   ...test_user  â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   @postgres:    â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   5432/         â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚   dashtam_test  â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚                 â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚ App NOT running â”‚  â”‚                 â”‚      â”‚
  â”‚  â”‚ (sleep mode)    â”‚  â”‚                 â”‚      â”‚
  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
  â”‚                                                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Makefile executes:                                      â”‚
  â”‚  docker-compose exec app                                 â”‚
  â”‚    uv run python src/core/init_test_db.py                â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           init_test_db.py runs                           â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  1. Load TestSettings (from .env)                        â”‚
  â”‚     â€¢ Actually reading .env.test (mounted as .env)       â”‚
  â”‚                                                          â”‚
  â”‚  2. âš ï¸  SAFETY CHECK                                     â”‚
  â”‚     â”œâ”€ ENVIRONMENT == "testing"? âœ“                       â”‚
  â”‚     â”œâ”€ DATABASE_URL contains "test"? âœ“                   â”‚
  â”‚     â””â”€ TESTING == true? âœ“                                â”‚
  â”‚                                                          â”‚
  â”‚  3. Connect to dashtam_test database                     â”‚
  â”‚     â€¢ Verify database name contains "test"               â”‚
  â”‚                                                          â”‚
  â”‚  4. Apply test optimizations                             â”‚
  â”‚     â”œâ”€ SET synchronous_commit = OFF                      â”‚
  â”‚     â”œâ”€ SET fsync = OFF (if allowed)                      â”‚
  â”‚     â””â”€ SET full_page_writes = OFF (if allowed)           â”‚
  â”‚                                                          â”‚
  â”‚  5. Import all models                                    â”‚
  â”‚     â”œâ”€ from src.models.user import User                  â”‚
  â”‚     â”œâ”€ from src.models.provider import Provider,         â”‚
  â”‚     â”‚   ProviderConnection, ProviderToken, AuditLog      â”‚
  â”‚     â””â”€ Models register with SQLModel.metadata            â”‚
  â”‚                                                          â”‚
  â”‚  6. ğŸ§¹ DROP all existing tables                          â”‚
  â”‚     â€¢ Ensures clean slate for every test run             â”‚
  â”‚                                                          â”‚
  â”‚  7. ğŸ—ï¸  CREATE all tables fresh                          â”‚
  â”‚     â”œâ”€ users                                             â”‚
  â”‚     â”œâ”€ providers                                         â”‚
  â”‚     â”œâ”€ provider_connections                              â”‚
  â”‚     â”œâ”€ provider_tokens                                   â”‚
  â”‚     â””â”€ provider_audit_logs                               â”‚
  â”‚                                                          â”‚
  â”‚  8. Verify all tables exist                              â”‚
  â”‚                                                          â”‚
  â”‚  9. âœ… Success - Test DB ready!                          â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Test Environment Ready               â”‚
  â”‚  â€¢ Clean database                     â”‚
  â”‚  â€¢ App container running (sleep mode) â”‚
  â”‚  â€¢ Ready for pytest execution         â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Developer runs: make test-unit                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚  Makefile executes:                                      â”‚
  â”‚  docker-compose exec app                                 â”‚
  â”‚    uv run pytest tests/unit/ -v                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚           Pytest runs inside container                   â”‚
  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
  â”‚                                                          â”‚
  â”‚  â€¢ Uses test database (dashtam_test)                     â”‚
  â”‚  â€¢ Fixtures from conftest.py                             â”‚
  â”‚  â€¢ Test config from test_config.py                       â”‚
  â”‚  â€¢ Isolated from dev database                            â”‚
  â”‚                                                          â”‚
  â”‚  Results: X passed, Y failed                             â”‚
  â”‚                                                          â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database State Comparison

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            POSTGRESQL CONTAINER STATE                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                     â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚   â”‚         PostgreSQL Instance (Single Container)           â”‚      â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚
â”‚   â”‚                                                          â”‚      â”‚
â”‚   â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚      â”‚
â”‚   â”‚  â”‚   DATABASE: dashtam â”‚   â”‚DATABASE: dashtam_testâ”‚      â”‚      â”‚
â”‚   â”‚  â”‚   (Development)     â”‚   â”‚    (Testing)         â”‚      â”‚      â”‚
â”‚   â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤      â”‚      â”‚
â”‚   â”‚  â”‚                     â”‚   â”‚                      â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ Owner: dashtam_user â”‚   â”‚ Owner: dashtam_      â”‚      â”‚      â”‚
â”‚   â”‚  â”‚                     â”‚   â”‚        test_user     â”‚      â”‚      â”‚
â”‚   â”‚  â”‚                     â”‚   â”‚                      â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ Tables:             â”‚   â”‚ Tables:              â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ users             â”‚   â”‚ â€¢ users              â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ providers         â”‚   â”‚ â€¢ providers          â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ provider_         â”‚   â”‚ â€¢ provider_          â”‚      â”‚      â”‚
â”‚   â”‚  â”‚   connections       â”‚   â”‚   connections        â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ provider_tokens   â”‚   â”‚ â€¢ provider_tokens    â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ provider_audit_   â”‚   â”‚ â€¢ provider_audit_    â”‚      â”‚      â”‚
â”‚   â”‚  â”‚   logs              â”‚   â”‚   logs               â”‚      â”‚      â”‚
â”‚   â”‚  â”‚                     â”‚   â”‚                      â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ Data:               â”‚   â”‚ Data:                â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ Persistent        â”‚   â”‚ â€¢ Dropped on each    â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ Survives restarts â”‚   â”‚   test-setup         â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ Real OAuth tokens â”‚   â”‚ â€¢ Always clean       â”‚      â”‚      â”‚
â”‚   â”‚  â”‚ â€¢ Provider configs  â”‚   â”‚ â€¢ Mock data only     â”‚      â”‚      â”‚
â”‚   â”‚  â”‚                     â”‚   â”‚                      â”‚      â”‚      â”‚
â”‚   â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚      â”‚
â”‚   â”‚                                                          â”‚      â”‚
â”‚   â”‚  COMPLETELY ISOLATED - No data sharing!                  â”‚      â”‚
â”‚   â”‚                                                          â”‚      â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Environment Switching Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              SWITCHING BETWEEN ENVIRONMENTS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Scenario 1: Dev â†’ Test â†’ Dev
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Dev Running  â”‚
  â”‚ make up      â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (You run: make test-setup)
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Dev STOPS    â”‚
  â”‚ Containers   â”‚
  â”‚ restart with â”‚
  â”‚ test config  â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Test Running â”‚
  â”‚ Dev DB still â”‚
  â”‚ has data!    â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (You run: make test-clean)
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Test STOPS   â”‚
  â”‚ Test DB      â”‚
  â”‚ destroyed    â”‚
  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ (You run: make up)
         â–¼
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ Dev Running  â”‚
  â”‚ AGAIN!       â”‚
  â”‚ All dev data â”‚
  â”‚ intact! âœ“    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


Scenario 2: What NOT to Do
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

  âŒ Running: make up && make test-setup
     (in different terminals simultaneously)
  
  Result: Containers conflict!
  Both try to use same container names.
  
  Solution: Stop one before starting the other.
```

---

## Configuration Loading Hierarchy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 DEVELOPMENT CONFIGURATION                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Docker Compose Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ docker-compose.yml                               â”‚
  â”‚                                                  â”‚
  â”‚ environment:                                     â”‚
  â”‚   DATABASE_URL: postgresql+asyncpg://...         â”‚
  â”‚                 ${POSTGRES_USER}:${POSTGRES_     â”‚
  â”‚                 PASSWORD}@postgres:5432/         â”‚
  â”‚                 ${POSTGRES_DB}                   â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (reads from)
                       â–¼
  Environment File Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ .env                                             â”‚
  â”‚                                                  â”‚
  â”‚ POSTGRES_DB=dashtam                              â”‚
  â”‚ POSTGRES_USER=dashtam_user                       â”‚
  â”‚ POSTGRES_PASSWORD=secure_password_change_me      â”‚
  â”‚ ENVIRONMENT=development                          â”‚
  â”‚ DEBUG=true                                       â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (loaded by)
                       â–¼
  Pydantic Settings Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ src/core/config.py                               â”‚
  â”‚                                                  â”‚
  â”‚ class Settings(BaseSettings):                    â”‚
  â”‚     DATABASE_URL: str                            â”‚
  â”‚     ENVIRONMENT: str = "production"              â”‚
  â”‚     DEBUG: bool = False                          â”‚
  â”‚                                                  â”‚
  â”‚     model_config = SettingsConfigDict(           â”‚
  â”‚         env_file=".env",                         â”‚
  â”‚     )                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (used by)
                       â–¼
  Application Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ src/main.py, src/core/init_db.py                 â”‚
  â”‚                                                  â”‚
  â”‚ from src.core.config import settings             â”‚
  â”‚                                                  â”‚
  â”‚ settings.DATABASE_URL  â† Final value!            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  TEST CONFIGURATION                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  Docker Compose Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ docker-compose.test.yml (OVERRIDES base)         â”‚
  â”‚                                                  â”‚
  â”‚ environment:                                     â”‚
  â”‚   DATABASE_URL: postgresql+asyncpg://            â”‚
  â”‚                 ${TEST_POSTGRES_USER}:           â”‚
  â”‚                 ${TEST_POSTGRES_PASSWORD}@       â”‚
  â”‚                 postgres:5432/                   â”‚
  â”‚                 ${TEST_POSTGRES_DB}              â”‚
  â”‚   ENVIRONMENT: testing                           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (reads from)
                       â–¼
  Environment File Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ .env.test (via --env-file flag)                  â”‚
  â”‚                                                  â”‚
  â”‚ TEST_POSTGRES_DB=dashtam_test                    â”‚
  â”‚ TEST_POSTGRES_USER=dashtam_test_user             â”‚
  â”‚ TEST_POSTGRES_PASSWORD=test_password             â”‚
  â”‚ ENVIRONMENT=testing                              â”‚
  â”‚ TESTING=true                                     â”‚
  â”‚ DEBUG=true                                       â”‚
  â”‚                                                  â”‚
  â”‚ (Also mounted as /app/.env inside container!)    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (loaded by)
                       â–¼
  Pydantic Settings Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ tests/test_config.py                             â”‚
  â”‚                                                  â”‚
  â”‚ class TestSettings(Settings):                    â”‚
  â”‚     TESTING: bool = True                         â”‚
  â”‚     DISABLE_EXTERNAL_CALLS: bool = True          â”‚
  â”‚                                                  â”‚
  â”‚     model_config = SettingsConfigDict(           â”‚
  â”‚         env_file=".env",  â† reads .env.test!     â”‚
  â”‚     )                                            â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚ (used by)
                       â–¼
  Test Layer
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ src/core/init_test_db.py, tests/*                â”‚
  â”‚                                                  â”‚
  â”‚ from tests.test_config import get_test_settings  â”‚
  â”‚                                                  â”‚
  â”‚ test_settings.DATABASE_URL  â† Test DB!           â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Key Takeaways

### âœ… What You Need to Remember

1. **Dev and test use the SAME containers** but with different configurations
2. **Dev data is NEVER lost** when running tests (different database)
3. **Test data is ALWAYS fresh** (dropped and recreated each time)
4. **You cannot run dev and test simultaneously** (container name conflicts)
5. **Switching is easy**: `make test-clean` â†’ `make up`

### âš ï¸  Critical Safety Features

1. **init_test_db.py has safety checks** - won't run on production
2. **Test database name must contain "test"** - verified before operations
3. **ENVIRONMENT must be "testing"** - double-checked
4. **Tables are dropped first** - ensures clean state every time

### ğŸ¯ Best Practices

1. **Always run `make test-setup` first** before running tests
2. **Use `make test-clean`** when done testing
3. **Don't manually connect to test database** - let scripts handle it
4. **Dev database persists** - your OAuth tokens and test data are safe
