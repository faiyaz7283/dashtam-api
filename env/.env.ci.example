# CI/CD Environment Configuration
# This file contains CI-specific environment variables for automated testing
# Copy this to .env.ci and customize if needed (though defaults should work)

# Application Configuration
APP_NAME=Dashtam
ENVIRONMENT=testing
DEBUG=true
LOG_LEVEL=INFO
API_V1_PREFIX=/api/v1

# Event System Configuration
# Strict mode fails fast if required event handlers are missing (default: true)
# CI must enforce strict mode to catch missing handlers before merge
EVENTS_STRICT_MODE=true

# SSE (Server-Sent Events) Configuration
# Enable event retention for Last-Event-ID reconnection replay
# Enabled in CI to verify retention and replay functionality
SSE_ENABLE_RETENTION=true

# Application URLs (internal Docker network communication - HTTPS)
API_BASE_URL=https://app:8000
CALLBACK_BASE_URL=https://callback:8182
VERIFICATION_URL_BASE=https://app:8000

# SSL/TLS Configuration (self-signed certs for CI)
API_SSL_CERT_FILE=certs/cert.pem
API_SSL_KEY_FILE=certs/key.pem
API_CALLBACK_SSL_CERT_FILE=certs/callback_cert.pem
API_CALLBACK_SSL_KEY_FILE=certs/callback_key.pem

# CORS Configuration (HTTPS for production parity)
CORS_ORIGINS=https://app:8000,https://localhost:8000

# PostgreSQL Configuration
POSTGRES_DB=dashtam_test
POSTGRES_USER=dashtam_test_user
POSTGRES_PASSWORD=test_password
POSTGRES_PORT=5432
POSTGRES_INITDB_ARGS=-E UTF8 --lc-collate=C --lc-ctype=C

# Application Database Configuration
DATABASE_URL=postgresql+asyncpg://dashtam_test_user:test_password@postgres:5432/dashtam_test
DB_ECHO=false

# Redis Configuration (in-memory for CI)
REDIS_URL=redis://redis:6379/1
REDIS_PORT=6379

# Cache Configuration (TTLs in seconds)
CACHE_KEY_PREFIX=dashtam
CACHE_USER_TTL=300          # User data cache: 5 minutes
CACHE_PROVIDER_TTL=300      # Provider connection cache: 5 minutes
CACHE_SCHWAB_TTL=300        # Schwab API response cache: 5 minutes
CACHE_ACCOUNTS_TTL=300      # Account list cache: 5 minutes
CACHE_SECURITY_TTL=60       # Security config cache: 1 minute

# Background Jobs Configuration (dashtam-jobs)
# The API monitors the dashtam-jobs background worker service via shared Redis.
# In CI, uses same Redis instance as cache (REDIS_URL fallback).
#
# JOBS_QUEUE_NAME must match dashtam-jobs service configuration.
# JOBS_REDIS_URL=redis://redis:6379/1  # Optional: use different DB
JOBS_QUEUE_NAME=dashtam:jobs

# Security Configuration (CI test keys - never use in production)
SECRET_KEY=ci-test-secret-key-never-use-in-production-32-chars-long!
ENCRYPTION_KEY=ci-key-for-encryption-test-32!@#
ALGORITHM=HS256
# Access token: 15 minutes (matches production security policy)
ACCESS_TOKEN_EXPIRE_MINUTES=15
REFRESH_TOKEN_EXPIRE_DAYS=30

# CI-specific flags
TESTING=true
CI=true
DISABLE_EXTERNAL_CALLS=true
MOCK_PROVIDERS=true
FAST_ENCRYPTION=true
PYTHONUNBUFFERED=1

# Mock Provider Configuration for Testing
SCHWAB_API_KEY=mock_schwab_client_id
SCHWAB_API_SECRET=mock_schwab_client_secret
SCHWAB_API_BASE_URL=http://mock/schwab
SCHWAB_REDIRECT_URI=http://mock/oauth/schwab/callback

# Alpaca Configuration (mocked)
ALPACA_CLIENT_ID=mock_alpaca_client_id
ALPACA_CLIENT_SECRET=mock_alpaca_client_secret
ALPACA_API_BASE_URL=http://mock/alpaca
ALPACA_REDIRECT_URI=http://mock/oauth/alpaca/callback

# Chase Configuration (mocked)
CHASE_API_KEY=mock_chase_api_key
CHASE_API_SECRET=mock_chase_api_secret
CHASE_REDIRECT_URI=http://mock/oauth/chase/callback

# Optional: Code coverage reporting
# Set this in your CI secrets if using Codecov
CODECOV_TOKEN=

# Optional: CI platform detection
# These are typically set automatically by the CI platform
# GITHUB_ACTIONS=true
# GITLAB_CI=true
# JENKINS_URL=

# Geolocation
GEOLITE2_DB_PATH=/app/data/geolite2/GeoLite2-City.mmdb
